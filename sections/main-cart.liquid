{%- comment -%}
  AAEL Main Cart
  Shopping bag / cart page
{%- endcomment -%}

<section class="cart section">
  <div class="cart__inner grid">
    <div class="cart__header col-full">
      <h1 class="cart__title">{{ 'cart.general.title' | t }}</h1>
    </div>

    {%- if cart.item_count > 0 -%}
      <div class="cart__items col-3 col-mobile-full">
        <form action="{{ routes.cart_url }}" method="post" id="cart-form">
          {%- for item in cart.items -%}
            <div class="cart-item" data-line-item="{{ forloop.index }}">
              <a href="{{ item.url }}" class="cart-item__image">
                {%- if item.image -%}
                  <img 
                    src="{{ item.image | image_url: width: 200 }}"
                    alt="{{ item.title | escape }}"
                    width="100"
                    height="100"
                    loading="lazy"
                  >
                {%- endif -%}
              </a>

              <div class="cart-item__details">
                <h3 class="cart-item__title">
                  <a href="{{ item.url }}">{{ item.product.title }}</a>
                </h3>
                
                {%- if item.variant.title != 'Default Title' -%}
                  <p class="cart-item__variant">{{ item.variant.title }}</p>
                {%- endif -%}

                <p class="cart-item__price">{{ item.final_line_price | money }}</p>

                <div class="cart-item__actions">
                  <div class="quantity">
                    <button 
                      type="button" 
                      class="quantity__btn"
                      data-quantity-minus
                      aria-label="Decrease quantity"
                    >âˆ’</button>
                    <input 
                      type="number" 
                      class="quantity__input"
                      name="updates[]"
                      value="{{ item.quantity }}"
                      min="0"
                      aria-label="Quantity"
                      data-quantity-input
                    >
                    <button 
                      type="button" 
                      class="quantity__btn"
                      data-quantity-plus
                      aria-label="Increase quantity"
                    >+</button>
                  </div>

                  <a 
                    href="{{ routes.cart_change_url }}?line={{ forloop.index }}&quantity=0"
                    class="cart-item__remove"
                  >
                    {{ 'cart.general.remove' | t }}
                  </a>
                </div>
              </div>
            </div>
          {%- endfor -%}
        </form>
      </div>

      <div class="cart__summary col-1 col-mobile-full">
        <div class="cart__summary-inner">
          <div class="cart__subtotal">
            <span>{{ 'cart.general.subtotal' | t }}</span>
            <span>{{ cart.total_price | money }}</span>
          </div>

          <p class="cart__note">
            Shipping & taxes calculated at checkout
          </p>

          <a href="/checkout" class="cart__checkout btn btn--primary">
            {{ 'cart.general.checkout' | t }}
          </a>

          <a href="/collections/all" class="cart__continue">
            {{ 'cart.general.continue_shopping' | t }}
          </a>
        </div>
      </div>
    {%- else -%}
      <div class="cart__empty col-full">
        <p>{{ 'cart.general.empty' | t }}</p>
        <a href="/collections/all" class="btn btn--secondary">
          {{ 'cart.general.continue_shopping' | t }}
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

<style>
  .cart__header {
    margin-bottom: var(--space-6);
  }

  .cart__title {
    font-size: var(--text-lg);
    font-weight: 400;
  }

  /* Cart Item */
  .cart-item {
    display: flex;
    gap: var(--space-4);
    padding: var(--space-5) 0;
    border-bottom: 1px solid var(--color-border);
  }

  .cart-item:first-child {
    padding-top: 0;
  }

  .cart-item__image {
    flex-shrink: 0;
    width: 100px;
    aspect-ratio: 1;
    background: var(--color-bg-alt);
  }

  .cart-item__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .cart-item__details {
    flex: 1;
    min-width: 0;
  }

  .cart-item__title {
    font-size: var(--text-sm);
    font-weight: 400;
    margin-bottom: var(--space-1);
  }

  .cart-item__variant {
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-2);
  }

  .cart-item__price {
    font-size: var(--text-sm);
    margin-bottom: var(--space-3);
  }

  .cart-item__actions {
    display: flex;
    align-items: center;
    gap: var(--space-4);
  }

  .cart-item__remove {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    transition: color var(--duration-fast);
  }

  .cart-item__remove:hover {
    color: var(--color-text);
  }

  /* Summary */
  .cart__summary-inner {
    position: sticky;
    top: calc(var(--space-5) * 2 + 40px);
    padding: var(--space-5);
    background: var(--color-bg-alt);
  }

  .cart__subtotal {
    display: flex;
    justify-content: space-between;
    font-size: var(--text-sm);
    margin-bottom: var(--space-2);
  }

  .cart__note {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    margin-bottom: var(--space-5);
  }

  .cart__checkout {
    display: block;
    width: 100%;
    text-align: center;
    margin-bottom: var(--space-3);
  }

  .cart__continue {
    display: block;
    text-align: center;
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
  }

  /* Empty state */
  .cart__empty {
    text-align: center;
    padding: var(--space-9) 0;
  }

  .cart__empty p {
    margin-bottom: var(--space-5);
    color: var(--color-text-muted);
  }

  @media (max-width: 768px) {
    .cart__items,
    .cart__summary {
      grid-column: span 2;
    }

    .cart__summary-inner {
      position: static;
      margin-top: var(--space-5);
    }
  }
</style>

<script>
  // Quantity buttons
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('cart-form');
    if (!form) return;

    form.addEventListener('click', function(e) {
      const minus = e.target.closest('[data-quantity-minus]');
      const plus = e.target.closest('[data-quantity-plus]');
      
      if (!minus && !plus) return;

      const input = (minus || plus).parentElement.querySelector('[data-quantity-input]');
      const current = parseInt(input.value);

      if (minus && current > 0) {
        input.value = current - 1;
      } else if (plus) {
        input.value = current + 1;
      }

      // Auto-submit on change
      form.submit();
    });
  });
</script>

{% schema %}
{
  "name": "Cart",
  "settings": []
}
{% endschema %}

