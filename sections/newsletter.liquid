{%- liquid
  assign padding_top = section.settings.padding_top | default: 40
  assign padding_bottom = section.settings.padding_bottom | default: 80
-%}

<div class="newsletter-section-wrapper" style="padding-top: {{ padding_top }}px; padding-bottom: {{ padding_bottom }}px;">
  <div class="grid-container">
    <div 
      class="grid-block"
      style="
        --span-s: span 2;
        --align-s: center;
        --text-s: center;
        --span-m: span 4;
        --align-m: center;
        --text-m: center;
        --span-l: span 6;
        --align-l: center;
        --text-l: center;
        --span-xl: span 8;
        --align-xl: center;
        --text-xl: center;
      "
    >
      {%- form 'contact', id: 'contact_form', class: 'newsletter-form-prelaunch', novalidate: 'novalidate' -%}
        {%- assign show_success = false -%}
        {%- if form.posted_successfully? or request.path contains 'preview=success' -%}
          {%- assign show_success = true -%}
        {%- endif -%}
        {%- if show_success -%}
          <div class="newsletter-text" style="width: 100%; margin: 0 auto; text-align: center;">
            {%- if section.settings.newsletter_subtitle != blank -%}
              <p style="font-size: 16px; color: var(--fg); opacity: 0.5; margin-bottom: 16px; letter-spacing: 0.5px;">
                {{ section.settings.newsletter_subtitle }}
              </p>
            {%- endif -%}
            <h2 class="lead-text" style="margin-bottom: 16px;">
              Confirmed
            </h2>
            <p style="font-size: 16px; color: var(--fg); opacity: 0.5; letter-spacing: 0.3px;">
              48-hour early notice for AMO is set.
            </p>
          </div>
        {%- else -%}
          <div class="newsletter-text" style="width: 100%; margin: 0 auto; text-align: center; margin-bottom: 32px;">
            {%- if section.settings.newsletter_subtitle != blank -%}
              <p style="font-size: 16px; color: var(--fg); opacity: 0.5; margin-bottom: 16px; letter-spacing: 0.5px;">
                {{ section.settings.newsletter_subtitle }}
              </p>
            {%- endif -%}
            <h2 class="lead-text" style="white-space: pre-line;">{{ section.settings.newsletter_title }}</h2>
          </div>
        {%- endif -%}
      
      {%- unless show_success -%}
        <div id="newsletter-form" class="newsletter-wrapper" style="width: 100%; max-width: 600px; margin: 0 auto; text-align: center;">
          {%- assign email_error = false -%}
          {%- if form.errors and form.errors.messages.email != blank -%}
            {%- assign email_error = true -%}
          {%- endif -%}

          <input type="hidden" name="contact[tags]" value="newsletter,prelaunch">
          <input type="hidden" name="return_to" value="{{ request.path }}#newsletter-form">
          <div class="newsletter-input-group" style="display: flex; width: 100%; max-width: {{ section.settings.form_max_width }}px; margin: 0 auto; gap: 8px; align-items: center;">
            <input 
              type="email" 
              name="contact[email]"
              class="newsletter-input-prelaunch{% if email_error %} error{% endif %}"
              placeholder="{{ section.settings.newsletter_placeholder }}"
              required
              aria-describedby="newsletter-error"
            >
            <div class="newsletter-button-wrapper">
              <button type="submit" class="pill-btn" aria-describedby="newsletter-error">
                {{ section.settings.newsletter_button }}
              </button>
            </div>
            <div class="newsletter-error-message{% if email_error %} visible{% endif %}" id="newsletter-error" role="alert">
              <span class="newsletter-error-icon" aria-hidden="true">ÙÄÅü</span>
              <span>{% if email_error %}{{ form.errors.messages.email | default: "Please include an '@' in the email address." }}{% else %}Please include an '@' in the email address.{% endif %}</span>
            </div>
          </div>
        </div>
      {%- endunless -%}
        {%- endform -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Newsletter",
  "tag": "section",
  "class": "section-newsletter",
  "settings": [
    {
      "type": "text",
      "id": "newsletter_subtitle",
      "label": "Newsletter subtitle",
      "default": "Spring 2026"
    },
    {
      "type": "text",
      "id": "newsletter_title",
      "label": "Newsletter title",
      "default": "First object. Base product line.\nLimited to 10 pieces."
    },
    {
      "type": "text",
      "id": "newsletter_placeholder",
      "label": "Email placeholder",
      "default": "Email"
    },
    {
      "type": "text",
      "id": "newsletter_button",
      "label": "Submit button text",
      "default": "Notify me"
    },
    {
      "type": "range",
      "id": "form_max_width",
      "min": 300,
      "max": 600,
      "step": 10,
      "default": 400,
      "unit": "px",
      "label": "Form Max Width"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 40,
      "unit": "px",
      "label": "Padding Top"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 80,
      "unit": "px",
      "label": "Padding Bottom"
    }
  ],
  "presets": [
    {
      "name": "Newsletter"
    }
  ]
}
{% endschema %}
